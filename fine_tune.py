import os
import openai
import json
from dotenv import load_dotenv

load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

# test = "Tag: Japan could constitutionally acquire nuclear weapons. \n\n Input: Japan Could Constitutionally Obtain Defensive Nuclear Weapons\nBoth under the old interpretation of Article 9 and under Prime Minister Abe's new interpretation, Japan could constitutionally obtain defensive nuclear weapons. Given the large-scale pushback against the new interpretation of Article 9,116 the current government may normatively prefer to acquire such weapons under the standards of the old interpretation. Nonetheless, even under the new interpretation, which allows for collective self-defense, acquisition of defensive nuclear weapons would quell the concerns of the citizens and would be preferable.\nJapan's Constitution has no affirmative prohibition against nuclear weapons.117 The portion of the Constitution that could preclude nuclear proliferation is Article 9, the prohibition against “war potential.”118 Yet, no Japanese court decision considered the constitutionality of nuclear weapons because, like in the United States, Japanese courts only review cases and controversies and, given that Japan never had nuclear weapons, nobody challenged such an acquisition. 119\nWhile arguments exist on both sides for whether nuclear proliferation would be constitutional, it is clear that obtaining nuclear weapons would be at least as permissible as expanding ground forces to engage in collective security. Given the nature of cases challenging the SDF,120 Prime Minister Abe's plan to expand self-defense forces is likely unconstitutional. But, even if Abe's assertions were indeed unconstitutional, this would not be dispositive of the constitutionality of nuclear weapons. Whereas self-defense forces could be seen as “war potential,” defensive nuclear weapons are just the opposite. They are strictly responsive, never meant to provoke, and they would not initiate war, but defend against it. While the Constitution itself may even preclude attacks taken in self-defense, 121 this view has been poorly received and even, under this view, one can reason that defensive nuclear weapons function as defensive insurance against other states' offensive attacks, not as an attack taken out of self-defense.\n \n\n###\n\n Highlighted Text:"
# test_2 = "Tag: Humans fail at disease prevention. \n\nInput: As Al continues improving and gets to the point where it becomes common in some areas to automate innovation, it is going to be really disruptive. Consider the example of medicines that consist of antibodieswhich include all of the best-selling biological drugs, like Humera. These are similar to the antibodies that your body makes naturally to target pathogens. From an innovation perspective, there is a limited number of antibodies-maybe billions or trillions, or even more-but there are only so many ways that you can combine proteins together to get an antibody.43 It is not hard to imagine an Al sequencing every possible antibody.44 An Al simply publishing that data might prevent any future patents on antibody sequences-the foundational patents of biological drug patent portfolios.\nTaking the example further, an Al might also predict what each antibody would do in the human body, what diseases it would treat, what side effects patients would experience, and so forth. Today's Al is already being used to do some of that.45 In the future, researchers could present some novel pathogen, like COVID-19, to an AI and the AI could go through its trillion-antibody library and pick the best one with which to make a drug.\n\n###\n\nHighlighted Text:"
# test = "Tag: Studies confirm AI can reverse secular stagnation. \n\nInput: To answer these two questions, we develop a simple theoretical growth framework explaining how intelligent technology knowledge may produce aggregate productivity spillovers and assess econometrically this prediction using patent data for a sample of industrialized countries from 1990 to 2014.\nFirst, we find that significant productivity gains are yielded by this knowledge as the elasticity of Total Factor Productivity (TFP) to the stock of patents in the fields of the 4IR ranges between 0.01 and 0.06. As innovations in this technological area have increased by a factor of (almost) 3 in the last quarter of century, knowledge featuring the 4IR would account for between 2.8 and 7.5% of observed productivity growth, based on our most conservative estimates. We provide large evidence on the robustness of the estimated productivity effects of intelligent technologies. We control for various measurement issues, in light of the large difficulties in defining the upcoming new technology. In this respect, we assess the sensitivity of the results to the use of alternative patent indicators (EPO patent applications vs triadic patent families), to how technological knowledge is approximated (stock vs flow) and the assumed rate of knowledge obsolescence (fast vs slow). Since intelligent technologies have been expanding rapidly and with large international differences in relation to the technological specialization of the economy, we allow the impact of the new technologies to vary across countries and over time. By tracing the time (year-by-year) pattern of productivity effects, we are therefore able to capture the effect of intelligent technologies over their (up-to-now) observed life cycle (gestation and take-off).4 More importantly, to exclude omit- ted variables' problems, we check whether the effect of intelligent technologies is distinct from productivity gains yielded by other sources of knowledge spillovers (patents in other technological fields, etc.), by the adoption of industrial robots, and other un-observable factors creating productivity dependence across countries (exogenous technology shocks, etc; see Eberhardt et al., 2013). In this context, we admit international technology transfers and inspect whether the estimated pro- ductivity effects of intelligent technologies capture spillovers from innovations developed by trade partner countries.\nSecond, we find that the time pattern of knowledge spillovers generated by intelligent technologies conforms to a productivity J-curve. The productivity effects of intelligent technologies appear to have been low and decreasing at the very beginning of their diffusion. Then, these effects have risen and become positive, stabilizing in terms of value after few years. Although this evidence is, admittedly, purely indicative, it is quite suggestive about the role that intelligent technologies may play as next generation of GPTs, and possibly about their ability to reverse the trend in “secular” stagnation (Gordon, 2015). Our findings would corroborate the view that, along with the mismatch between measured investment and measured out- put of the new GPT, the productivity J-curve may also be due to the spread (and absorption) of knowledge embodied in intelligent technologies in industries far from their sector of origin. In other words, the observed productivity pattern would be a reflection of technological dynamism, co-invention and innovational complementarities induced by the diffusion of such pathbreaking technologies in downstream sectors (Brynjolfsson et al., 2018).\nOur work departs from most of the earlier literature as here we look at productivity gains associated with the development of intelligent technologies (production channel): these innovations give rise to the diffusion of new technological knowledge that, being non-rival and non-escludible, yields spillovers, or excess returns, in favor of the total economy. This contrasts to most previous studies as they seek to identify the productivity improvements and efficiency gains enabled by robot adoption (adoption channel) via cost savings and task expansion (productivity effect). From this perspective our evidence represents an important contribution to the debate on technological and social transformations related to the Fourth Industrial Revolution (Jager et al., 2016, OECD, 2018, Autor and Salomons, 2018).\n\n###\n\nHighlighted Text:"
test = "Tag: Pharma innovation is declining post-COVID. \n\nInput: As the world struggled to address the impacts of COVID-19, the United States raced to limit the spread of the virus by investing in biotech companies working around the clock to develop a vaccine. Despite the initial profits that came from those investments, once vaccines were developed and made widely available, the biotech industry lost its financial footing.\nFelipe Bastos Gurgel Silva, a professor in accounting at the University of Missouri, said there are a number of potential reasons why the biotech industry, which uses biology to produce health care-related products, has struggled financially since the pandemic. He recently worked with other experts to analyze stock prices to determine the industry's financial health.\nSilva said most people believed the light at the end of the tunnel for the pandemic would be medical innovations such as vaccines and effective treatments for COVID-19. But, he said, it's more complicated than that.\n“With so much demand, one would imagine that sectors that provide these innovations should be performing very well financially,” he said. “However, in reality, once vaccines became more readily available, the sector has been performing quite poorly.”\nBased on their findings, Silva believes this market volatility will eventually result in a diminished number of smaller biotech startups, which means medical innovation - such as the production of new drugs to fight diseases - could slow down.\n“Now that the sector is undervalued, a major consequence is that there will be less investors getting these projects off the ground which means there will be less people starting up biotech ventures, resulting in less innovation,” Silva said. “That could be the difference between having a successful drug that treats Alzheimer's disease, for example, in the next two years or the next five years.”\nOne potential reason Silva cited for the poor financial performance is because the U.S. Food and Drug Administration (FDA) and other researchers understandably have been forced to prioritize fighting the pandemic. Consequently, there is a backlog of FDA trials, which has temporarily slowed innovation in other areas.\nSilva said another possible reason is because the biotech industry is usually a sector that experiences high returns for its investors. By nature, it is a high risk and high reward market, meaning investors can lose or make an inordinately large amount of money. However, COVID-19 has affected these returns. With the potential for such high losses and the lower payouts, investors are more likely to invest in something associated with less risk. Silva said this shift in the industry has a trickle-down effect.\n“That makes you even more skeptical about investing your money in these firms,” Silva said. “We tend to think that most of the innovations in the biotech sector are done by big pharma, and they're a big part of that. But the core innovation is done by biotech firms. These smaller startups rely heavily on investments, and these investments will certainly be slowing down in the near future.”\n\n###\n\nHighlighted Text:"
# test = "Tag: China will be ahead the US in AI within a decade. \n\nInput: The recent Beijing Olympics showcased one particular threat, as China trotted out new artificial intelligence (AI) and robotics technologies with vital relevance to Washington's current geopolitical tensions with Beijing. From driverless buses to high-speed rail powered by 5G, advanced Chinese technology was featured front and center. Indeed, the digital currency-only games, focused around the e-CNY currency which has already been picked up by some 140 million people, were a little peek into a reality that China has embraced while the West has dithered.\nAs the recent Olympics emphasized, AI is a driving obsession for China. The robot chefs making burgers at Olympic facilities and the smart beds measuring athletes' vital statistics weren't just gimmicks for the cameras: they're a symbol of how China has quickly eclipsed the United States when it comes to the deployment and use of AI technologies.\nChina is doubling down on next-generation tech in general and AI in particular, while the United States is falling behind-to such an extent that the Pentagon's first chief software officer Nicolas Chaillan resigned last fall in protest over the slow pace of technological transformation in the United States, saying that “we have no competing fighting chance against China in 15 to 20 years.”\nAccording to Chaillan, there's no way Washington is going to catch up to Beijing's cyber and AI capabilities. Many experts concur-Graham Allison, of the Belfer Center, recently noted that many American officials are far too complacent about Western supremacy in technology, while Pakistani researcher Ruqayya Anwer wrote in an op-ed earlier this year that “China has won the AI battle with the U.S. and is on its way to world supremacy.” In particular, Anwer concluded that China will vastly dominate any number of strategic technologies, including AI, within a decade or two. \nThe West has offered plenty of excuses for lagging behind on AI, not least arguments about how Communist China doesn't have the same ethical standards and privacy concerns as Europe and North America. The truth, however, is that AI will be increasingly key to the future of national power and cohesion. In stark terms-if the United States wants to preserve its values and keep pace with China, it needs to get very serious about AI, very fast.\nUp until now, that has simply not been the case. Successive American administrations have let AI languish-and, as a result, even American-based AI firms are looking abroad for business. Take NASDAQ-listed Remark Holdings, for example. Remark is doing crucial work by developing AI-based solutions such as its platform which uses computer vision to monitor transport corridors like Florida's Brightline Rail-the United States' deadliest railway per mile-and make them safer. Nevertheless, Remark Holdings currently generates the majority of its revenue in China-for one simple reason, the fact that China has a history of valuing and prioritizing AI, while the United States doesn't.\nAs for the military side of things, the United States is far behind. Only now is the American military properly stepping away from its longtime use of Chinese-manufactured DJI drones and using American-made AI drones, from U.S. manufacturer Skydio, instead. That's a bit late to the party, to say the least, given the fact that security concerns have persisted for years over using Chinese technology in sensitive sectors. \nWhile the U.S. Department of Defense has increasingly committed to developing American-made AI tools, leading figures like former Deputy Secretary of Defense Robert Work are clear about the challenges ahead, noting that “America is not prepared to defend or compete in the AI era.”\nEconomically, letting AI fall to the wayside is also incredibly shortsighted and negligent. From farming to manufacturing, artificial intelligence could give humans an assist, helping them do their jobs faster and more efficiently-yet while China leaps ahead in this regard, the United States keeps on taking half measures.\n\n###\n\nHighlighted Text:"
# test = "Tag: Liability gaps cause space conflict. \n\nInput: Furthermore, the Liability Convention's focus on strict liability is not only inconsistent with the general understanding of state responsibility in international law, but also creates an unworkable standard that is highly unlikely to be enforced or relied upon. At present, instead of properly attributing responsibility for harmful acts, the Liability Convention's terms seem to incentivize the Holmesian bad man's use of another state's satellites to cause harm to his own rivals precisely because he will not be made to pay for it. Instead of holding the bad actor accountable, the regime's rules force an innocent launching state to pay restitution to any other state that was harmed by a third party's use of the launching state's satellites as destructive tools. Such absurd ownership-based punishment makes little sense if the Liability Convention's purpose is to create \"effective international rules and procedures concerning liability\" that strengthen \"international cooperation.\" 77 Presently, it would be unreasonable for launching states, which face a near-guarantee of liability in these situations, to cooperate and pay restitution without some sort of security for when they are not at fault. Because of this, the result of the regime may well be more international tension and armed conflict instead of dispute resolution.\nIt should also be noted that the Liability Convention's terms have no textual exception for acts of war, meaning that even incidents during wartime still fall under its provisions. 78 However, the Liability Convention is unlikely to prevent acts of war. It is overwhelmingly improbable that a perpetrator of a premeditated act of war will be willing to compensate a victim state while a war between them is ongoing. Additionally, the longstanding custom in armed conflict is that each state determines how restitution will be paid to its own citizens harmed by acts of war. 79 Thus, if a state makes an attack using a space object and such attack constitutes an act of war, the problem of uncompensated harm will still exist in the absence of a later treaty between the warring states. A decision by a claims commission called to address a claim under the Liability Convention may play a part in peace negotiations, but it would be unrealistic to assume that it would carry force in the midst of war. Thus, the Liability Convention will not in all cases \"ensure . . . the prompt payment . . . of a full and equitable measure of compensation to victims\" of damage caused by space objects. 80\nUnfortunately, despite its sweeping terms, the current liability regime probably has its strongest likelihood of being adhered to in the case of an accident involving states party that already engage in regular diplomacy with each other--a case where it is probably least necessary precisely because of that ongoing relationship. However, as the Cosmos 954 incident discussed above illustrates, even states party that have an established diplomatic channel have been highly averse to relying on the terms of the Liability Convention. Although the Liability Convention has the laudable aims of compensating all harm, creating predictability, and establishing orderly resolution of disputes, it presently falls short in achieving its stated goals. The Liability Convention's terms create predictability at the expense of preventing orderly resolution of disputes, and thereby fail to ensure compensation for harm. Forcing an innocent state to pay for the harm caused by actions of another beyond its control cannot possibly be reconciled with background principles of international law, and doing so therefore threatens the effectiveness of the whole regime. Unfortunately, because the current regime does just that, it invites chaos and disaster.\nIn light of these considerations, the liability regime created by the Liability Convention should be retooled in order to operate more realistically and fairly. As the above discussion of acts of war shows, it will not be possible to compensate harm caused by satellites in all instances. Moreover, perfect predictability of results is useless if the winner and loser are always preordained but cooperation and consent from both is required. Without the victim's sanction, the claims commission can do nothing of substance. Instead, the liability regime should ensure that when a nation is at fault for harm caused outside of war, it pays for that harm. The liability regime should similarly ensure that innocent parties--victims of harm and those whose satellites were hijacked alike--bear as little burden as possible. If the launching state has the possibility to receive compensation in turn from the guilty party, it may be more willing to submit to the jurisdiction of the claims commission. At the very least, in no case should the liability regime operate to shield bad actors from liability for the harm they cause. The liability loophole must be closed in order to ensure that justice is served.\n\n###\n\nHighlighted Text:"
# test = "Tag: No bioterror impact. \n\nInput: Biological agents are particularly ill-suited to terrorists, whose goal, recall, is not damage but theater (chapter 13).58 The biologist Paul Ewald notes that natural selection among pathogens works against the terrorist's goal of sudden and spectacular devastation. 59 Germs that depend on rapid person-to-person contagion, like the common-cold virus, are selected to keep their hosts alive and ambulatory so they can shake hands with and sneeze on as many people as possible. Germs get greedy and kill their hosts only if they have some other way of getting from body to body, like mosquitoes (for malaria), a contaminable water supply (for cholera), or trenches packed with injured soldiers (for the 1918 Spanish flu). Sexually transmitted pathogens, like HIV and syphilis, are somewhere in between, needing a long and symptomless incubation period during which hosts can infect their partners, after which the germs do their damage. Virulence and contagion thus trade off, and the evolution of germs will frustrate the terrorist's aspiration to launch a headline-worthy epidemic that is both swift and lethal. Theoretically, a bioterrorist could try to bend the curve with a pathogen that is virulent, contagious, and durable enough to survive outside bodies. But breeding such a fine-tuned germ would require Nazi-like experiments on living humans that even terrorists (to say nothing of teenagers) are unlikely to carry off. It may be more than just luck that the world so far has seen just one successful bioterror attack (the 1984 tainting of salad with salmonella in an Oregon town by the Rajneeshee religious cult, which killed no one) and one spree killing (the 2001 anthrax mailings, which killed five).60 To be sure, advances in synthetic biology, such as the gene-editing technique CRISPR-Cas9, make it easier to tinker with organisms, including pathogens. But it's difficult to re-engineer a complex evolved trait by inserting a gene or two, since the effects of any gene are intertwined with the rest of the organism's genome. Ewald notes, “I don't think that we are close to understanding how to insert combinations of genetic variants in any given pathogen that act in concert to generate high transmissibility and stably high virulence for humans.”61 The biotech expert Robert Carlson adds that “one of the problems with building any flu virus is that you need to keep your production system (cells or eggs) alive long enough to make a useful quantity of something that is trying to kill that production system. . . . Booting up the resulting virus is still very, very difficult. . . . I would not dismiss this threat completely, but frankly I am much more worried about what Mother Nature is throwing at us all the time.”62 And crucially, advances in biology work the other way as well: they also make it easier for the good guys [public protectors] (and there are many more of them) to identify pathogens, invent antibiotics that overcome antibiotic resistance, and rapidly develop vaccines.63 An example is the Ebola vaccine, developed in the waning days of the 2014–15 emergency, after public health efforts had capped the toll at twelve thousand deaths rather than the millions that the media had foreseen. Ebola thus joined a list of other falsely predicted pandemics such as Lassa fever, hantavirus, SARS, mad cow disease, bird flu, and swine flu.64 Some of them never had the potential to go pandemic in the first place because they are contracted from animals or food rather than in an exponential tree of person-to-person infections. Others were nipped by medical and public health interventions. Of course no one knows for sure whether an evil genius will someday overcome the world's defenses and loose a plague upon the world for fun, vengeance, or a sacred cause. But journalistic habits and the Availability and Negativity biases inflate the odds, which is why I have taken Sir Martin up on his bet. By the time you read this you may know who has won.65 \n\n###\n\nHighlighted Text:"

# model_name = "curie:ft-personal-2023-01-26-01-51-54"
underline_model = "curie:ft-personal-2023-01-26-03-54-27"
highlight_model = "curie:ft-personal-2023-01-26-04-52-23"
emphasis_model = "curie:ft-personal-2023-01-26-15-57-42"
file_name = "file-d3aPjxPEcWn6PLOe7MHTWTXk"


response = openai.Completion.create(
  model=underline_model,
  prompt=test,
  max_tokens=int(len(test)/4 - 50),
  temperature=0,
  stop="\n"
)

choices = response.choices
output = choices[0].text
output_arr = json.loads(output)
output_str = " ".join(output_arr)
print("Underlined text: " + output_str)

highlight_response = openai.Completion.create(
  model=highlight_model,
  # prompt=test.split(" \n\nInput: ")[0] + " \n\nInput: " + output_str + "\n\n###\n\nHighlighted Text:",
  prompt=test,
  max_tokens=int(len(test)/4),
  temperature=0,
  stop="\n"
)

highlight_choices = highlight_response.choices
highlight_output = highlight_choices[0].text
highlight_output_arr = json.loads(highlight_output)
highlight_output_str = " ".join(highlight_output_arr)
print("Highlighted text: ")
print(highlight_output_arr)

emphasis_response = openai.Completion.create(
  model=emphasis_model,
  prompt=test.split(" \n\nInput: ")[0] + " \n\nInput: " + output_str + "\n\n###\n\nHighlighted Text:",
  max_tokens=int(len(output_str)/4),
  temperature=0,
  stop="\n"
)

emphasis_choices = emphasis_response.choices
emphasis_output = emphasis_choices[0].text
emphasis_output_arr = json.loads(emphasis_output)
emphasis_output_str = " ".join(emphasis_output_arr)
print("Emphasized text: ")
print(emphasis_output_arr)


# response = openai.FineTune.create(training_file=file_name, model="curie")
# response = openai.FineTune.retrieve(id="ft-N59sbYVhMZZgZOIDaxKqjPlg")
# response = openai.FineTune.list()
# print(response)



# print(openai.File.list())
# openai.File.create(
#   file=open("output-emphasis.jsonl", "rb"),
#   purpose='fine-tune',
#   user_provided_filename="output-emphasis"
# )
